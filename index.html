<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å£°æ§åœ°å›¾ (çº¯å‡€å‘å…‰ç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #0b1124; /* æ·±è“èƒŒæ™¯ */
            overflow: hidden;
            font-family: "Microsoft YaHei", sans-serif;
        }

        #map-container {
            width: 100%;
            height: 100%;
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  - ç°åœ¨æ˜¯æŸ¥çœ‹å›½å®¶åçš„ä¸»è¦ä½ç½® */
        #status-bar {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
            pointer-events: none;
            width: 80%; /* åŠ å®½ä»¥é€‚åº”é•¿åå­— */
        }

        #voice-msg {
            display: inline-block;
            background: rgba(11, 17, 36, 0.9); /* åŠ æ·±èƒŒæ™¯ï¼Œçªå‡ºæ–‡å­— */
            border: 1px solid #00d0ff;
            color: #00d0ff;
            padding: 12px 40px;
            border-radius: 50px;
            font-size: 24px; /* åŠ å¤§å­—ä½“ */
            font-weight: bold;
            box-shadow: 0 0 20px rgba(0, 208, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            text-shadow: 0 0 10px rgba(0, 208, 255, 0.5);
        }

        /* æŒ‰é’®æ ·å¼ */
        #start-btn {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            padding: 15px 50px;
            background: linear-gradient(135deg, #0066ff, #00ccff);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 150, 255, 0.5);
            transition: transform 0.1s;
        }

        #start-btn:active { transform: translateX(-50%) scale(0.95); }
    </style>
</head>
<body>

    <div id="status-bar">
        <div id="voice-msg">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’® -> å…è®¸éº¦å…‹é£ -> è¯´å‡ºå›½å®¶å</div>
    </div>
    
    <div id="map-container"></div>
    <button id="start-btn">ç‚¹å‡»å¼€å¯å£°æ§</button>

    <script>
        const myChart = echarts.init(document.getElementById('map-container'));
        let recognition;
        let highlightTimer = null; 

        // === å›½å®¶ä¸­è‹±æ–‡æ˜ å°„è¡¨ ===
        const countryNameMap = {
            'China': 'ä¸­å›½',
            'United States': 'ç¾å›½',
            'Russia': 'ä¿„ç½—æ–¯',
            'Japan': 'æ—¥æœ¬',
            'United Kingdom': 'è‹±å›½',
            'France': 'æ³•å›½',
            'Germany': 'å¾·å›½',
            'Canada': 'åŠ æ‹¿å¤§',
            'Australia': 'æ¾³å¤§åˆ©äºš',
            'India': 'å°åº¦',
            'Brazil': 'å·´è¥¿',
            'South Korea': 'éŸ©å›½',
            'North Korea': 'æœé²œ',
            'Pakistan': 'å·´åŸºæ–¯å¦',
            'Italy': 'æ„å¤§åˆ©',
            'Spain': 'è¥¿ç­ç‰™',
            'Ukraine': 'ä¹Œå…‹å…°',
            'Turkey': 'åœŸè€³å…¶',
            'Iran': 'ä¼Šæœ—',
            'Iraq': 'ä¼Šæ‹‰å…‹',
            'Afghanistan': 'é˜¿å¯Œæ±—',
            'Vietnam': 'è¶Šå—',
            'Thailand': 'æ³°å›½',
            'Indonesia': 'å°åº¦å°¼è¥¿äºš',
            'Malaysia': 'é©¬æ¥è¥¿äºš',
            'Philippines': 'è²å¾‹å®¾',
            'Singapore': 'æ–°åŠ å¡',
            'Mexico': 'å¢¨è¥¿å“¥',
            'Argentina': 'é˜¿æ ¹å»·',
            'Chile': 'æ™ºåˆ©',
            'South Africa': 'å—é',
            'Egypt': 'åŸƒåŠ',
            'Saudi Arabia': 'æ²™ç‰¹é˜¿æ‹‰ä¼¯',
            'Israel': 'ä»¥è‰²åˆ—',
            'Poland': 'æ³¢å…°',
            'Sweden': 'ç‘å…¸',
            'Norway': 'æŒªå¨',
            'Finland': 'èŠ¬å…°',
            'Netherlands': 'è·å…°',
            'Belgium': 'æ¯”åˆ©æ—¶',
            'Switzerland': 'ç‘å£«',
            'Austria': 'å¥¥åœ°åˆ©',
            'Greece': 'å¸Œè…Š',
            'Portugal': 'è‘¡è„ç‰™',
            'New Zealand': 'æ–°è¥¿å…°',
            'Mongolia': 'è’™å¤',
            'Kazakhstan': 'å“ˆè¨å…‹æ–¯å¦',
            'Bulgaria': 'ä¿åŠ åˆ©äºš',
            'Romania': 'ç½—é©¬å°¼äºš',
            'Hungary': 'åŒˆç‰™åˆ©',
            'Czech Republic': 'æ·å…‹',
            'Slovakia': 'æ–¯æ´›ä¼å…‹',
            'Belarus': 'ç™½ä¿„ç½—æ–¯',
            'Taiwan': 'ä¸­å›½å°æ¹¾',
            'Vatican': 'æ¢µè’‚å†ˆ',
            'Monaco': 'æ‘©çº³å“¥',
            'Luxembourg': 'å¢æ£®å ¡'
        };

        // 1. åŠ è½½å¹¶é‡æ„åœ°å›¾æ•°æ®
        myChart.showLoading({ text: 'æ­£åœ¨åŠ è½½çº¯å‡€ç‰ˆåœ°å›¾...', color: '#00d0ff', textColor: '#fff' });

        fetch('https://cdn.jsdelivr.net/npm/echarts@4.9.0/map/json/world.json')
            .then(res => res.json())
            .then(worldJson => {
                // åœ°å›¾ç§»ä½ç®—æ³•
                worldJson.features.forEach(feature => {
                    const geometry = feature.geometry;
                    const shiftCoord = (coord) => {
                        if (coord[0] < -30) coord[0] += 360;
                        return coord;
                    };
                    if (geometry.type === "Polygon") {
                        geometry.coordinates.forEach(ring => ring.forEach(shiftCoord));
                    } else if (geometry.type === "MultiPolygon") {
                        geometry.coordinates.forEach(poly => poly.forEach(ring => ring.forEach(shiftCoord)));
                    }
                });

                echarts.registerMap('world', worldJson);
                myChart.hideLoading();
                initMap();
                initSpeech();
            });

        // 2. åˆå§‹åŒ–åœ°å›¾é…ç½®
        function initMap() {
            const option = {
                backgroundColor: '#0b1124',
                // Tooltip ä»ç„¶ä¿ç•™ï¼Œä½œä¸ºé¼ æ ‡äº¤äº’çš„è¾…åŠ©
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}',
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' },
                    borderColor: '#00d0ff'
                },
                series: [
                    {
                        type: 'map',
                        map: 'world',
                        roam: true,
                        zoom: 1.1,
                        center: [150, 30],
                        
                        // === æ ¸å¿ƒä¿®æ”¹ï¼šæ™®é€šçŠ¶æ€ ===
                        label: {
                            show: false, // æ°¸è¿œä¸æ˜¾ç¤ºæ ‡ç­¾
                        },

                        itemStyle: {
                            areaColor: '#1a2640', 
                            borderColor: '#455a84',
                            borderWidth: 1
                        },

                        // === æ ¸å¿ƒä¿®æ”¹ï¼šé¼ æ ‡æ‚¬åœçŠ¶æ€ ===
                        emphasis: {
                            label: { show: false }, // é¼ æ ‡æ”¾ä¸Šå»ä¹Ÿä¸æ˜¾ç¤ºæ–‡å­—ï¼Œé˜²æ­¢æŒ¡ä½å°å›½
                            itemStyle: { areaColor: '#2a3f66' }
                        },

                        // === æ ¸å¿ƒä¿®æ”¹ï¼šé€‰ä¸­/é«˜äº®çŠ¶æ€ (è¯­éŸ³è§¦å‘) ===
                        selectedMode: 'multiple', 
                        select: {
                            label: { 
                                show: false, // ï¼ï¼ï¼é€‰ä¸­æ—¶åšå†³ä¸æ˜¾ç¤ºæ–‡å­—ï¼Œåªå‘å…‰ï¼ï¼ï¼
                            },
                            itemStyle: {
                                areaColor: '#ffcc00', 
                                borderColor: '#fff',
                                borderWidth: 2,
                                shadowColor: 'rgba(255, 204, 0, 1)', 
                                shadowBlur: 30 // å…‰æ™•å¼ºä¸€ç‚¹ï¼Œå“ªæ€•å›½å®¶åªæœ‰ä¸€ä¸ªç‚¹ä¹Ÿèƒ½çœ‹æ¸…
                            }
                        },

                        nameMap: countryNameMap,
                        data: [] 
                    }
                ]
            };
            myChart.setOption(option);
            
            myChart.on('click', function(params) {
                highlightWithTimer(params.name);
            });
        }

        // 3. è¯­éŸ³è¯†åˆ«é€»è¾‘
        function initSpeech() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

            if (!SpeechRecognition) {
                document.getElementById('voice-msg').innerText = "æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³";
                return;
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'zh-CN';
            recognition.continuous = false; 
            recognition.interimResults = false;

            const msgBox = document.getElementById('voice-msg');
            const btn = document.getElementById('start-btn');

            recognition.onstart = function() {
                msgBox.innerText = "ğŸ¤ è†å¬ä¸­... è¯´å‡ºå›½å®¶å";
                msgBox.style.color = "#fff";
                msgBox.style.borderColor = "#fff";
                msgBox.style.textShadow = "none";
                btn.style.display = 'none';
            };

            recognition.onend = function() {
                try { recognition.start(); } catch(e) {}
            };

            recognition.onresult = function(event) {
                const text = event.results[0][0].transcript;
                handleCommand(text);
            };

            btn.onclick = function() {
                try { recognition.start(); } catch(e) {}
            };
        }

        // 4. å¤„ç†æŒ‡ä»¤
        function handleCommand(text) {
            const msgBox = document.getElementById('voice-msg');
            let matchedCountry = null;

            for (let enName in countryNameMap) {
                const cnName = countryNameMap[enName];
                if (text.includes(cnName)) {
                    matchedCountry = cnName;
                    break;
                }
            }

            if (matchedCountry) {
                // åœ¨é¡¶éƒ¨ UI å¤§å­—æ˜¾ç¤ºè¯†åˆ«ç»“æœ
                msgBox.innerText = `âœ¨ è¯†åˆ«åˆ°ï¼š${matchedCountry}`;
                msgBox.style.color = "#ffcc00"; // é‡‘è‰²æ–‡å­—
                msgBox.style.borderColor = "#ffcc00"; // é‡‘è‰²è¾¹æ¡†
                msgBox.style.textShadow = "0 0 20px rgba(255, 204, 0, 0.8)"; // é‡‘è‰²æ–‡å­—å‘å…‰
                
                highlightWithTimer(matchedCountry);
            } else {
                msgBox.innerText = `ğŸ¤” å¬åˆ°äº†: "${text}"`;
                msgBox.style.color = "#00d0ff";
                msgBox.style.borderColor = "#00d0ff";
                msgBox.style.textShadow = "none";
            }
        }

        // 5. é«˜äº® + 2ç§’è‡ªåŠ¨ç†„ç­
        function highlightWithTimer(name) {
            if (highlightTimer) clearTimeout(highlightTimer);

            myChart.dispatchAction({ type: 'unselect', seriesIndex: 0 }); 
            myChart.dispatchAction({ type: 'downplay', seriesIndex: 0 }); 

            myChart.dispatchAction({
                type: 'select',
                seriesIndex: 0,
                name: name
            });
            myChart.dispatchAction({
                type: 'highlight',
                seriesIndex: 0,
                name: name
            });

            highlightTimer = setTimeout(() => {
                myChart.dispatchAction({
                    type: 'unselect',
                    seriesIndex: 0,
                    name: name
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    seriesIndex: 0,
                    name: name
                });
                
                // æ¢å¤æç¤º
                const msgBox = document.getElementById('voice-msg');
                msgBox.innerText = "ğŸ¤ è¯·ç»§ç»­è¯´è¯...";
                msgBox.style.color = "#fff";
                msgBox.style.borderColor = "#fff";
                msgBox.style.textShadow = "none";

            }, 2000); 
        }

        window.onresize = function() { myChart.resize(); };

    </script>
</body>
</html>
