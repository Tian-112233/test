<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â£∞ÊéßÂú∞Âõæ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #0b1124;
            overflow: hidden;
            font-family: "Microsoft YaHei", sans-serif;
        }

        #map-container {
            width: 100%;
            height: 100%;
        }

        #status-bar {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            text-align: center;
            pointer-events: none;
            width: 90%; 
        }

        #voice-msg {
            display: inline-block;
            background: rgba(11, 17, 36, 0.95);
            border: 1px solid #00d0ff;
            color: #00d0ff;
            padding: 12px 40px;
            border-radius: 50px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(0, 208, 255, 0.4);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            text-shadow: 0 0 10px rgba(0, 208, 255, 0.5);
        }

        #start-btn {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            padding: 15px 50px;
            background: linear-gradient(135deg, #0066ff, #00ccff);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 150, 255, 0.5);
            transition: transform 0.1s;
        }

        #start-btn:active { transform: translateX(-50%) scale(0.95); }
    </style>
</head>
<body>

    <div id="status-bar">
        <div id="voice-msg">ÁÇπÂáª‰∏ãÊñπÊåâÈíÆ -> ÂÖÅËÆ∏È∫¶ÂÖãÈ£é -> ÂºÄÂßãËØ¥ËØù</div>
    </div>
    
    <div id="map-container"></div>
    <button id="start-btn">ÁÇπÂáªÂºÄÂêØÂ£∞Êéß</button>

    <script>
        const myChart = echarts.init(document.getElementById('map-container'));
        let recognition;
        let highlightTimer = null; 

        // === 1. ÂêåÈü≥ËØçÁ∫†ÈîôÂ≠óÂÖ∏ (Ëß£ÂÜ≥"Êô∫Âäõ"Âèò"Êô∫Âà©"Á≠âÈóÆÈ¢ò) ===
        const homophoneMap = {
            'Êô∫Âäõ': 'Êô∫Âà©',
            'Ê≤ªÁêÜ': 'Êô∫Âà©',
            'Ëá¥Âäõ': 'Êô∫Âà©',
            'Ëá¥Âà©': 'Êô∫Âà©',
            'ÊªûÂà©': 'Êô∫Âà©',
            'ÈúâÂõΩ': 'ÁæéÂõΩ',
            'ÁæéËøá': 'ÁæéÂõΩ',
            'ÈπÖÁΩóÊñØ': '‰øÑÁΩóÊñØ',
            'ÂèëÂõΩ': 'Ê≥ïÂõΩ',
            'ÂæóÂõΩ': 'Âæ∑ÂõΩ',
            'ÊÑèÂ§ßÁ´ã': 'ÊÑèÂ§ßÂà©',
            'Êæ≥Â§ßÊùé‰∫ö': 'Êæ≥Â§ßÂà©‰∫ö',
            'Â∑¥Âñú': 'Â∑¥Ë•ø',
            'Â§™Êπæ': '‰∏≠ÂõΩÂè∞Êπæ',
            'Áî±Â§™': 'ÁäπÂ§™',
            'ÂèôÂà©ÈõÖ': 'ÂèôÂà©‰∫ö',
            '‰æùÊãâÂÖã': '‰ºäÊãâÂÖã',
            'ÈòøÂØåÊ±ó': 'ÈòøÂØåÊ±ó', 
            'ÂàöÊûúÈáë': 'ÂàöÊûú(Èáë)',
            'ÂàöÊûúÂ∏É': 'ÂàöÊûú(Â∏É)'
        };

        // === 2. ÈíàÂØπ ECharts Â∫ïÂ±ÇÊï∞ÊçÆÂêçÁß∞ÁöÑÁ≤æÂáÜÊò†Â∞ÑË°® ===
        const countryNameMap = {
            // --- Ê†∏ÂøÉÂÆπÊòìÂá∫ÈîôÂå∫ ---
            'Korea': 'Èü©ÂõΩ',
            'Dem. Rep. Korea': 'ÊúùÈ≤ú',
            'Lao PDR': 'ËÄÅÊåù',
            'Viet Nam': 'Ë∂äÂçó',
            'Vietnam': 'Ë∂äÂçó',
            'Myanmar': 'ÁºÖÁî∏',
            'United States': 'ÁæéÂõΩ',
            'United States of America': 'ÁæéÂõΩ',

            // --- ‰∫öÊ¥≤ ---
            'China': '‰∏≠ÂõΩ',
            'Japan': 'Êó•Êú¨',
            'Mongolia': 'ËíôÂè§',
            'India': 'Âç∞Â∫¶',
            'Pakistan': 'Â∑¥Âü∫ÊñØÂù¶',
            'Bangladesh': 'Â≠üÂä†ÊãâÂõΩ',
            'Sri Lanka': 'ÊñØÈáåÂÖ∞Âç°',
            'Nepal': 'Â∞ºÊ≥äÂ∞î',
            'Bhutan': '‰∏ç‰∏π',
            'Thailand': 'Ê≥∞ÂõΩ',
            'Cambodia': 'Êü¨ÂüîÂØ®',
            'Malaysia': 'È©¨Êù•Ë•ø‰∫ö',
            'Singapore': 'Êñ∞Âä†Âù°',
            'Indonesia': 'Âç∞Â∫¶Â∞ºË•ø‰∫ö',
            'Brunei': 'ÊñáËé±',
            'Philippines': 'Ëè≤ÂæãÂÆæ',
            'Kazakhstan': 'ÂìàËê®ÂÖãÊñØÂù¶',
            'Uzbekistan': '‰πåÂÖπÂà´ÂÖãÊñØÂù¶',
            'Kyrgyzstan': 'ÂêâÂ∞îÂêâÊñØÊñØÂù¶',
            'Tajikistan': 'Â°îÂêâÂÖãÊñØÂù¶',
            'Turkmenistan': 'ÂúüÂ∫ìÊõºÊñØÂù¶',
            'Afghanistan': 'ÈòøÂØåÊ±ó',
            'Iran': '‰ºäÊúó',
            'Iraq': '‰ºäÊãâÂÖã',
            'Syria': 'ÂèôÂà©‰∫ö',
            'Jordan': 'Á∫¶Êó¶',
            'Lebanon': 'ÈªéÂ∑¥Â´©',
            'Israel': '‰ª•Ëâ≤Âàó',
            'Palestine': 'Â∑¥ÂãíÊñØÂù¶',
            'Saudi Arabia': 'Ê≤ôÁâπÈòøÊãâ‰ºØ',
            'Yemen': '‰πüÈó®',
            'Oman': 'ÈòøÊõº',
            'United Arab Emirates': 'ÈòøËÅîÈÖã',
            'Qatar': 'Âç°Â°îÂ∞î',
            'Kuwait': 'ÁßëÂ®ÅÁâπ',
            'Bahrain': 'Â∑¥Êûó',
            'Turkey': 'ÂúüËÄ≥ÂÖ∂',
            
            // --- Ê¨ßÊ¥≤ ---
            'Russia': '‰øÑÁΩóÊñØ',
            'Germany': 'Âæ∑ÂõΩ',
            'United Kingdom': 'Ëã±ÂõΩ',
            'France': 'Ê≥ïÂõΩ',
            'Italy': 'ÊÑèÂ§ßÂà©',
            'Spain': 'Ë•øÁè≠Áâô',
            'Ukraine': '‰πåÂÖãÂÖ∞',
            'Poland': 'Ê≥¢ÂÖ∞',
            'Romania': 'ÁΩóÈ©¨Â∞º‰∫ö',
            'Netherlands': 'Ëç∑ÂÖ∞',
            'Belgium': 'ÊØîÂà©Êó∂',
            'Czech Rep.': 'Êç∑ÂÖã',
            'Czech Republic': 'Êç∑ÂÖã',
            'Greece': 'Â∏åËÖä',
            'Portugal': 'Ëë°ËêÑÁâô',
            'Sweden': 'ÁëûÂÖ∏',
            'Hungary': 'ÂåàÁâôÂà©',
            'Belarus': 'ÁôΩ‰øÑÁΩóÊñØ',
            'Austria': 'Â••Âú∞Âà©',
            'Switzerland': 'ÁëûÂ£´',
            'Bulgaria': '‰øùÂä†Âà©‰∫ö',
            'Serbia': 'Â°ûÂ∞îÁª¥‰∫ö',
            'Denmark': '‰∏πÈ∫¶',
            'Finland': 'Ëä¨ÂÖ∞',
            'Slovakia': 'ÊñØÊ¥õ‰ºêÂÖã',
            'Norway': 'Êå™Â®Å',
            'Ireland': 'Áà±Â∞îÂÖ∞',
            'Croatia': 'ÂÖãÁΩóÂú∞‰∫ö',
            'Moldova': 'Êë©Â∞îÂ§öÁì¶',
            'Bosnia and Herz.': 'Ê≥¢Èªë',
            'Albania': 'ÈòøÂ∞îÂ∑¥Â∞º‰∫ö',
            'Lithuania': 'Á´ãÈô∂ÂÆõ',
            'Macedonia': 'ÂåóÈ©¨ÂÖ∂È°ø',
            'Slovenia': 'ÊñØÊ¥õÊñáÂ∞º‰∫ö',
            'Latvia': 'ÊãâËÑ±Áª¥‰∫ö',
            'Estonia': 'Áà±Ê≤ôÂ∞º‰∫ö',
            'Montenegro': 'ÈªëÂ±±',
            'Luxembourg': 'Âç¢Ê£ÆÂ†°',
            'Iceland': 'ÂÜ∞Â≤õ',

            // --- ÁæéÊ¥≤ (ÈáçÁÇπÂÖ≥Ê≥®Êô∫Âà©) ---
            'Chile': 'Êô∫Âà©', // Á°Æ‰øùÊô∫Âà©Êò†Â∞ÑÊ≠£Á°Æ
            'Brazil': 'Â∑¥Ë•ø',
            'Argentina': 'ÈòøÊ†πÂª∑',
            'Colombia': 'Âì•‰º¶ÊØî‰∫ö',
            'Peru': 'ÁßòÈ≤Å',
            'Venezuela': 'ÂßîÂÜÖÁëûÊãâ',
            'Ecuador': 'ÂéÑÁìúÂ§öÂ∞î',
            'Bolivia': 'ÁéªÂà©Áª¥‰∫ö',
            'Paraguay': 'Â∑¥ÊãâÂú≠',
            'Uruguay': '‰πåÊãâÂú≠',
            'Guyana': 'Âú≠‰∫öÈÇ£',
            'Suriname': 'ËãèÈáåÂçó',
            'French Guiana': 'Ê≥ïÂ±ûÂú≠‰∫öÈÇ£',
            'Canada': 'Âä†ÊãøÂ§ß',
            'Mexico': 'Â¢®Ë•øÂì•',
            'Guatemala': 'Âç±Âú∞È©¨Êãâ',
            'Cuba': 'Âè§Â∑¥',
            'Haiti': 'Êµ∑Âú∞',
            'Dominican Rep.': 'Â§öÁ±≥Â∞ºÂä†',
            'Honduras': 'Ê¥™ÈÉΩÊãâÊñØ',
            'El Salvador': 'Ëê®Â∞îÁì¶Â§ö',
            'Nicaragua': 'Â∞ºÂä†ÊãâÁìú',
            'Costa Rica': 'Âì•ÊñØËææÈªéÂä†',
            'Panama': 'Â∑¥ÊãøÈ©¨',
            'Jamaica': 'Áâô‰π∞Âä†',
            'Bahamas': 'Â∑¥ÂìàÈ©¨',
            'Greenland': 'Ê†ºÈôµÂÖ∞',

            // --- ÈùûÊ¥≤ ---
            'Nigeria': 'Â∞ºÊó•Âà©‰∫ö',
            'Egypt': 'ÂüÉÂèä',
            'Dem. Rep. Congo': 'ÂàöÊûú(Èáë)',
            'Congo': 'ÂàöÊûú(Â∏É)',
            'Tanzania': 'Âù¶Ê°ëÂ∞º‰∫ö',
            'South Africa': 'ÂçóÈùû',
            'Kenya': 'ËÇØÂ∞º‰∫ö',
            'Uganda': '‰πåÂπ≤Ëææ',
            'Algeria': 'ÈòøÂ∞îÂèäÂà©‰∫ö',
            'Sudan': 'Ëãè‰∏π',
            'Morocco': 'Êë©Ê¥õÂì•',
            'Angola': 'ÂÆâÂì•Êãâ',
            'Mozambique': 'Ëé´Ê°ëÊØîÂÖã',
            'Ghana': 'Âä†Á∫≥',
            'Madagascar': 'È©¨ËææÂä†ÊñØÂä†',
            'Cameroon': 'ÂñÄÈ∫¶ÈöÜ',
            'C√¥te d\'Ivoire': 'ÁßëÁâπËø™Áì¶',
            'Ivory Coast': 'ÁßëÁâπËø™Áì¶',
            'Niger': 'Â∞ºÊó•Â∞î',
            'Burkina Faso': 'Â∏ÉÂü∫Á∫≥Ê≥ïÁ¥¢',
            'Mali': 'È©¨Èáå',
            'Malawi': 'È©¨ÊãâÁª¥',
            'Zambia': 'ËµûÊØî‰∫ö',
            'Senegal': 'Â°ûÂÜÖÂä†Â∞î',
            'Chad': '‰πçÂæó',
            'Somalia': 'Á¥¢È©¨Èáå',
            'Zimbabwe': 'Ê¥•Â∑¥Â∏ÉÈü¶',
            'Guinea': 'Âá†ÂÜÖ‰∫ö',
            'Rwanda': 'Âç¢Êó∫Ëææ',
            'Tunisia': 'Á™ÅÂ∞ºÊñØ',
            'S. Sudan': 'ÂçóËãè‰∏π',
            'Libya': 'Âà©ÊØî‰∫ö',
            'Central African Rep.': '‰∏≠Èùû',
            'Liberia': 'Âà©ÊØîÈáå‰∫ö',
            'Mauritania': 'ÊØõÈáåÂ°îÂ∞º‰∫ö',
            'Namibia': 'Á∫≥Á±≥ÊØî‰∫ö',
            'Botswana': 'ÂçöËå®Áì¶Á∫≥',
            'Gabon': 'Âä†Ëì¨',
            'Ethiopia': 'ÂüÉÂ°û‰øÑÊØî‰∫ö',
            
            // --- Â§ßÊ¥ãÊ¥≤ ---
            'Australia': 'Êæ≥Â§ßÂà©‰∫ö',
            'New Zealand': 'Êñ∞Ë•øÂÖ∞',
            'Papua New Guinea': 'Â∑¥Â∏É‰∫öÊñ∞Âá†ÂÜÖ‰∫ö',
            'Fiji': 'ÊñêÊµé',
            'Vanuatu': 'Áì¶Âä™ÈòøÂõæ',
            'Solomon Is.': 'ÊâÄÁΩóÈó®Áæ§Â≤õ',

            // --- ÁâπÊÆä ---
            'Taiwan': '‰∏≠ÂõΩÂè∞Êπæ',
            'Puerto Rico': 'Ê≥¢Â§öÈªéÂêÑ'
        };

        // 3. Âä†ËΩΩÊï∞ÊçÆ
        myChart.showLoading({ text: 'Ê≠£Âú®ÂàùÂßãÂåñÂú∞Âõæ...', color: '#00d0ff', textColor: '#fff' });

        fetch('https://cdn.jsdelivr.net/npm/echarts@4.9.0/map/json/world.json')
            .then(res => res.json())
            .then(worldJson => {
                worldJson.features.forEach(feature => {
                    const geometry = feature.geometry;
                    const shiftCoord = (coord) => {
                        if (coord[0] < -30) coord[0] += 360;
                        return coord;
                    };
                    if (geometry.type === "Polygon") {
                        geometry.coordinates.forEach(ring => ring.forEach(shiftCoord));
                    } else if (geometry.type === "MultiPolygon") {
                        geometry.coordinates.forEach(poly => poly.forEach(ring => ring.forEach(shiftCoord)));
                    }
                });

                echarts.registerMap('world', worldJson);
                myChart.hideLoading();
                initMap();
                initSpeech();
            });

        function initMap() {
            const option = {
                backgroundColor: '#0b1124',
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}', 
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    textStyle: { color: '#fff' },
                    borderColor: '#00d0ff'
                },
                series: [
                    {
                        type: 'map',
                        map: 'world',
                        roam: true,
                        zoom: 1.1,
                        center: [150, 30],
                        label: { show: false }, 
                        itemStyle: {
                            areaColor: '#1a2640', 
                            borderColor: '#455a84',
                            borderWidth: 1
                        },
                        emphasis: {
                            label: { show: false }, 
                            itemStyle: { areaColor: '#2a3f66' }
                        },
                        selectedMode: 'multiple', 
                        select: {
                            label: { show: false }, 
                            itemStyle: {
                                areaColor: '#ffcc00', 
                                borderColor: '#fff',
                                borderWidth: 2,
                                shadowColor: 'rgba(255, 204, 0, 1)', 
                                shadowBlur: 30 
                            }
                        },
                        nameMap: countryNameMap, 
                        data: [] 
                    }
                ]
            };
            myChart.setOption(option);
            
            myChart.on('click', function(params) {
                highlightWithTimer(params.name);
            });
        }

        function initSpeech() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

            if (!SpeechRecognition) {
                document.getElementById('voice-msg').innerText = "ÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥";
                return;
            }

            recognition = new SpeechRecognition();
            recognition.lang = 'zh-CN';
            recognition.continuous = true; 
            recognition.interimResults = false;

            const msgBox = document.getElementById('voice-msg');
            const btn = document.getElementById('start-btn');

            recognition.onstart = function() {
                msgBox.innerText = "üé§ ËÅÜÂê¨‰∏≠... ËØ∑ÂÆåÊï¥ËØ¥ÔºöÊàëÊù•Ëá™XX";
                msgBox.style.color = "#fff";
                msgBox.style.borderColor = "#fff";
                msgBox.style.textShadow = "none";
                btn.style.display = 'none';
            };

            recognition.onend = function() {
                try { recognition.start(); } catch(e) {}
            };

            recognition.onresult = function(event) {
                const lastIndex = event.results.length - 1;
                // ÂéªÊ†áÁÇπ
                let text = event.results[lastIndex][0].transcript.replace(/[„ÄÇÔºå,.!?]/g, '');
                
                // === ÂÖ≥ÈîÆ‰øÆÊîπÔºöÂêåÈü≥Â≠óÊõøÊç¢ ===
                // Âç≥‰Ωø‰Ω†ËØ¥‰∫Ü"Êô∫Âäõ"ÔºåËøôÈáå‰πü‰ºöÂº∫Ë°åÊîπÊàê"Êô∫Âà©"
                for (let wrong in homophoneMap) {
                    if (text.includes(wrong)) {
                        text = text.replace(wrong, homophoneMap[wrong]);
                    }
                }

                console.log("Â§ÑÁêÜÂêéÁöÑÊñáÂ≠ó:", text);
                handleCommand(text);
            };

            btn.onclick = function() {
                try { recognition.start(); } catch(e) {}
            };
        }

        function handleCommand(text) {
            const msgBox = document.getElementById('voice-msg');
            let matchedCountry = null;

            for (let enName in countryNameMap) {
                const cnName = countryNameMap[enName];
                
                // ËøôÈáåÁöÑ text Â∑≤ÁªèÊòØÂ§ÑÁêÜËøáÂêåÈü≥Â≠óÁöÑ‰∫Ü
                if (text.includes("ÊàëÊù•Ëá™" + cnName)) {
                    matchedCountry = cnName;
                    break;
                }
            }

            if (matchedCountry) {
                msgBox.innerText = `‚ú® Ê¨¢ËøéÔºÅËØÜÂà´Âà∞Ôºö${matchedCountry}`;
                msgBox.style.color = "#ffcc00"; 
                msgBox.style.borderColor = "#ffcc00"; 
                msgBox.style.textShadow = "0 0 20px rgba(255, 204, 0, 0.8)"; 
                
                highlightWithTimer(matchedCountry);
            } else {
                let justName = null;
                for (let en in countryNameMap) {
                    if (text.includes(countryNameMap[en])) {
                        justName = countryNameMap[en];
                        break;
                    }
                }

                if (justName) {
                    msgBox.innerText = `‚ö†Ô∏è ËØ∑ËØ¥ÂÆåÊï¥Âè£‰ª§Ôºö‚ÄúÊàëÊù•Ëá™${justName}‚Äù`;
                    msgBox.style.color = "#ff5555"; 
                    msgBox.style.borderColor = "#ff5555";
                } else {
                    msgBox.innerText = `ü§î Ê†ºÂºè‰∏çÂØπÔºåËØ∑ËØ¥ÔºöÊàëÊù•Ëá™XX`;
                    msgBox.style.color = "#00d0ff";
                    msgBox.style.borderColor = "#00d0ff";
                }
                msgBox.style.textShadow = "none";
            }
        }

        function highlightWithTimer(name) {
            if (highlightTimer) clearTimeout(highlightTimer);

            myChart.dispatchAction({ type: 'unselect', seriesIndex: 0 }); 
            myChart.dispatchAction({ type: 'downplay', seriesIndex: 0 }); 

            myChart.dispatchAction({
                type: 'select',
                seriesIndex: 0,
                name: name
            });
            myChart.dispatchAction({
                type: 'highlight',
                seriesIndex: 0,
                name: name
            });

            highlightTimer = setTimeout(() => {
                myChart.dispatchAction({
                    type: 'unselect',
                    seriesIndex: 0,
                    name: name
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    seriesIndex: 0,
                    name: name
                });
                
                const msgBox = document.getElementById('voice-msg');
                msgBox.innerText = "üé§ ËÅÜÂê¨‰∏≠... ËØ∑ÂÆåÊï¥ËØ¥ÔºöÊàëÊù•Ëá™XX";
                msgBox.style.color = "#fff";
                msgBox.style.borderColor = "#fff";
                msgBox.style.textShadow = "none";

            }, 2000); 
        }

        window.onresize = function() { myChart.resize(); };

    </script>
</body>
</html>
