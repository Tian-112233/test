<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026Âπ¥Êó•ÂéÜ</title>
    <style>
        @import url('https://gs.jurieo.com/gemini/fonts-googleapis/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@500;700;900&display=swap');
        
        :root {
            --bg-wood: #2c1e14;
            --paper-base: #fcf8e8;
            --china-red: #b81c22;
            --gold: #e0b043;
            --ink: #1a1a1a;
        }

        body {
            background-color: var(--bg-wood);
            background-image: repeating-linear-gradient(90deg, #36251d 0, #36251d 2px, #2c1e14 0, #2c1e14 20px);
            margin: 0; height: 100vh;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            font-family: 'Noto Serif SC', serif;
            overflow: hidden; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- ËØ≠Èü≥ÂºÄÂÖ≥ --- */
        .voice-switch {
            position: fixed; top: 20px; left: 20px; z-index: 999;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            padding: 8px 18px; border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff; cursor: pointer;
            display: flex; align-items: center; gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 14px;
        }
        .voice-switch.active {
            background: rgba(184, 28, 34, 0.9);
            border-color: #ff6666;
            box-shadow: 0 0 15px rgba(184, 28, 34, 0.6);
        }
        .wave-bars { display: flex; gap: 3px; height: 12px; align-items: center; }
        .bar { width: 3px; height: 100%; background: #fff; border-radius: 2px; }
        .active .bar { animation: wave 0.6s infinite ease-in-out; }
        .active .bar:nth-child(1) { animation-delay: 0s; }
        .active .bar:nth-child(2) { animation-delay: 0.2s; }
        .active .bar:nth-child(3) { animation-delay: 0.4s; }
        .active .bar:nth-child(4) { animation-delay: 0.1s; }
        @keyframes wave { 0%, 100% { height: 4px; opacity: 0.5; } 50% { height: 16px; opacity: 1; } }

        /* --- Êç¢Â£ÅÁ∫∏ --- */
        .upload-corner {
            position: fixed; top: 20px; right: 20px;
            background: rgba(255,255,255,0.2);
            color: #fff; padding: 8px 15px; border-radius: 20px;
            font-size: 13px; cursor: pointer; z-index: 999;
            backdrop-filter: blur(5px);
        }

        /* --- Êó•ÂéÜ‰∏ª‰Ωì (‰øùÊåÅÂ§ßÂ∞∫ÂØ∏) --- */
        .calendar-scene {
            position: relative;
            width: 90vw; max-width: 420px; 
            height: 70vh; max-height: 680px;
            perspective: 2000px;
        }

        /* È°∂ÈÉ®Ë£ÖËÆ¢Êù° - ÁÇπÂáªÊ≠§Â§ÑÂèØÂêëÂâçÁøªÈ°µ */
        .binder-bar {
            position: absolute; top: -15px; left: 10px; right: 10px; height: 40px;
            background: linear-gradient(to bottom, #444, #222);
            border-radius: 6px; z-index: 500;
            display: flex; justify-content: space-evenly;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            cursor: pointer;
        }
        .binder-bar::after {
            content: "ÁÇπÂáªÊ≠§Â§ÑËøîÂõû‰∏ä‰∏ÄÊúà";
            position: absolute; top: -25px; width: 100%; text-align: center;
            color: rgba(255,255,255,0.4); font-size: 12px; pointer-events: none;
            opacity: 0; transition: opacity 0.3s;
        }
        .binder-bar:hover::after { opacity: 1; }
        .binder-bar:active { transform: translateY(1px); }

        .ring {
            width: 12px; height: 55px;
            background: linear-gradient(to right, #ccc, #fff, #ccc);
            border-radius: 6px; margin-top: -10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        /* È°µÈù¢Ê†∑Âºè */
        .page {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: var(--paper-base);
            border-radius: 12px;
            border: 1px solid #e0d0b0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            transform-origin: top center;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.645, 0.045, 0.355, 1);
            display: flex; flex-direction: column;
            overflow: hidden;
            backface-visibility: hidden;
        }
        .page.flipped { transform: rotateX(-160deg); opacity: 0; pointer-events: none; }

        /* Â§¥ÈÉ® */
        .header-section {
            height: 22%; background-color: var(--china-red);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            border-bottom-left-radius: 40px; border-bottom-right-radius: 40px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .header-section:active { background-color: #a0181d; }
        
        .month-name {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 3.5rem; color: var(--gold);
            text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
            line-height: 1;
        }
        .lunar-tag {
            color: rgba(255,255,255,0.9); margin-top: 5px; font-size: 1rem;
            border: 1px solid rgba(255,255,255,0.4);
            padding: 2px 12px; border-radius: 20px;
        }

        /* ÁΩëÊ†º */
        .grid-wrap { flex-grow: 1; padding: 15px; position: relative; cursor: pointer; }
        table { width: 100%; height: 100%; border-collapse: collapse; table-layout: fixed; }
        th { color: #886; font-size: 14px; height: 40px; }
        td {
            text-align: center; vertical-align: middle;
            font-size: 1.4rem; font-weight: 700;
            color: var(--ink);
            border-radius: 50%;
            position: relative; z-index: 2;
        }
        td:nth-child(1), td:nth-child(7) { color: #c02c26; }
        
        /* Â¢®Ê∞¥ */
        .ink-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 5;
        }
        .ink-circle {
            fill: none; stroke: #c02c26; stroke-width: 3;
            stroke-linecap: round; stroke-linejoin: round;
            stroke-dasharray: 600; stroke-dashoffset: 600;
            animation: draw 0.5s ease-out forwards;
        }
        @keyframes draw { to { stroke-dashoffset: 0; } }

    </style>
</head>
<body>

    <div class="voice-switch" id="voice-btn" onclick="toggleVoice()">
        <div class="wave-bars">
            <div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div>
        </div>
        <span id="status-txt">ÁÇπÂáªÂºÄÂêØÂ£∞Êéß</span>
    </div>

    <label class="upload-corner">
        üñºÔ∏è Êç¢Âõæ
        <input type="file" id="img-uploader" accept="image/*" style="display:none">
    </label>

    <div class="calendar-scene" id="scene">
        <div class="binder-bar" onclick="prevMonth(event)">
            <div class="ring"></div><div class="ring"></div><div class="ring"></div>
            <div class="ring"></div><div class="ring"></div><div class="ring"></div>
        </div>
        </div>

    <script>
        const MONTHS_CN = ["‰∏ÄÊúà","‰∫åÊúà","‰∏âÊúà","ÂõõÊúà","‰∫îÊúà","ÂÖ≠Êúà","‰∏ÉÊúà","ÂÖ´Êúà","‰πùÊúà","ÂçÅÊúà","ÂçÅ‰∏ÄÊúà","ÂçÅ‰∫åÊúà"];
        const LUNAR = ["ËÖäÊúà", "Ê≠£Êúà", "ÊùèÊúà", "Ê°ÉÊúà", "ÊßêÊúà", "Ëí≤Êúà", "Ëç∑Êúà", "ÂÖ∞Êúà", "Ê°ÇÊúà", "ËèäÊúà", "Èú≤Êúà", "ÂÜ¨Êúà"];
        const YEAR = 2026;

        let currentMonth = 1;
        let targetMonth = 1; 
        let isAnimating = false;
        let recognition = null;
        let isVoiceOn = false;

        window.onload = () => {
            initCalendar();
            initUploader();
            try { new AudioContext(); } catch(e){}
        };

        // --- Ê†∏ÂøÉÁøªÈ°µÈÄªËæë ---

        function nextMonth() {
            if(targetMonth < 12) {
                targetMonth++;
                processFlip();
            } else {
                playTone('pen', 800);
            }
        }

        function prevMonth(e) {
            if(e) e.stopPropagation();
            if(targetMonth > 1) {
                targetMonth--;
                processFlip();
            } else {
                playTone('pen', 800);
            }
        }

        async function processFlip() {
            if(isAnimating) return; 
            
            while(currentMonth !== targetMonth) {
                isAnimating = true;
                playTone('flip');

                if (targetMonth > currentMonth) {
                    document.getElementById(`page-${currentMonth}`).classList.add('flipped');
                    currentMonth++;
                } else {
                    currentMonth--;
                    document.getElementById(`page-${currentMonth}`).classList.remove('flipped');
                }
                
                await new Promise(r => setTimeout(r, 200));
            }
            isAnimating = false;
        }

        // --- ËØ≠Èü≥ÈÄªËæë (‰ºòÂåñÁâàÔºöÂè™Âú®ÂÅúÊ≠¢ËØ¥ËØùÂêéÊâßË°å) ---
        
        function toggleVoice() {
            const btn = document.getElementById('voice-btn');
            const txt = document.getElementById('status-txt');
            
            if(isVoiceOn) {
                isVoiceOn = false;
                if(recognition) recognition.stop();
                btn.classList.remove('active');
                txt.innerText = "ÁÇπÂáªÂºÄÂêØÂ£∞Êéß";
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if(!SpeechRecognition) {
                alert("ÊµèËßàÂô®‰∏çÊîØÊåÅËØ≠Èü≥ÔºåËØ∑‰ΩøÁî®ChromeÊàñSafari„ÄÇ");
                return;
            }

            if(!recognition) {
                recognition = new SpeechRecognition();
                recognition.lang = 'zh-CN';
                recognition.continuous = true;
                recognition.interimResults = true; 

                recognition.onend = () => { if(isVoiceOn) try{ recognition.start(); }catch(e){} };
                
                recognition.onresult = (e) => {
                    const result = e.results[e.results.length - 1];
                    const transcript = result[0].transcript;
                    
                    // ÂÆûÊó∂ÊòæÁ§∫Âê¨Âà∞ÁöÑÂÜÖÂÆπÔºåËÆ©ÊÇ®Áü•ÈÅìÂÆÉÂú®Âê¨
                    txt.innerText = transcript;

                    // „ÄêÂÖ≥ÈîÆ‰øÆÊîπ„ÄëÔºöÂè™ÊúâÂΩì isFinal ‰∏∫ true (ËøôÊï¥Âè•ËØùÁªìÊùü‰∫Ü) ÊâçÊâßË°åÂëΩ‰ª§
                    // ËøôÊ†∑Â∞±‰∏ç‰ºöÂú®ÊÇ®ËØ¥Âà∞‰∏ÄÂçäÊó∂‰π±Áîª‰∫Ü
                    if (result.isFinal) {
                        const success = parseCommand(transcript);
                        if(success) {
                            txt.innerText = "Â∑≤ÊâßË°å";
                            // 1.5ÁßíÂêéÊÅ¢Â§çÊèêÁ§∫ÊñáÂ≠ó
                            setTimeout(() => { if(isVoiceOn) txt.innerText = "Ê≠£Âú®ËÅÜÂê¨..."; }, 1500);
                        }
                    }
                };
            }
            
            try {
                recognition.start();
                isVoiceOn = true;
                btn.classList.add('active');
                txt.innerText = "Ê≠£Âú®ËÅÜÂê¨...";
            } catch(e){}
        }

        function parseCommand(str) {
            str = str.replace(/[Ôºå„ÄÇÔºüÔºÅ,.]/g, '');
            console.log("Processing Final Command:", str);
            
            const map = {'‰∏Ä':1,'‰∫å':2,'‰∏â':3,'Âõõ':4,'‰∫î':5,'ÂÖ≠':6,'‰∏É':7,'ÂÖ´':8,'‰πù':9,'ÂçÅ':10,'ÂçÅ‰∏Ä':11,'ÂçÅ‰∫å':12};
            let m = -1, d = -1;

            let mMatch = str.match(/([‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅ]+|\d+)Êúà/);
            if(mMatch) {
                let s = mMatch[1];
                m = map[s] || parseInt(s);
            }

            let afterMonth = m !== -1 ? str.split('Êúà')[1] : str;
            if(afterMonth) {
                if(afterMonth.includes("‰∏âÂçÅ")) d = 30 + (map[afterMonth.split("‰∏âÂçÅ")[1]?.[0]] || 0);
                else if(afterMonth.includes("‰∫åÂçÅ")) d = 20 + (map[afterMonth.split("‰∫åÂçÅ")[1]?.[0]] || 0);
                else if(afterMonth.includes("ÂçÅ") && !afterMonth.startsWith("‰∫å") && !afterMonth.startsWith("‰∏â")) {
                    let p = afterMonth.split("ÂçÅ");
                    d = 10 + (map[p[1]?.[0]] || 0);
                } 
                else {
                    for(let k in map) if(afterMonth.includes(k+"Âè∑") || afterMonth.includes(k+"Êó•")) d = map[k];
                }
                if(d === -1) {
                    let num = afterMonth.match(/\d+/);
                    if(num) d = parseInt(num[0]);
                }
            }

            let executed = false;
            if (m !== -1 && m >= 1 && m <= 12) {
                if (targetMonth !== m) {
                    targetMonth = m;
                    processFlip().then(() => {
                        if (d !== -1) setTimeout(() => circleDate(m, d), 300);
                    });
                    executed = true;
                } else {
                    if (d !== -1) {
                        circleDate(m, d);
                        executed = true;
                    }
                }
            } 
            else if (m === -1 && d !== -1) {
                // Â¶ÇÊûúÂè™ËØ¥‰∫ÜÊó•ÊúüÔºåÈªòËÆ§Êìç‰ΩúÂΩìÂâçÊúà
                circleDate(currentMonth, d);
                executed = true;
            }

            return executed;
        }

        function circleDate(m, d) {
            if(m !== currentMonth) return;
            
            const cell = document.getElementById(`d-${m}-${d}`);
            if(!cell || cell.getAttribute('data-circled') === 'true') return;
            
            playTone('pen');
            cell.setAttribute('data-circled', 'true');
            
            const svg = document.getElementById(`ink-${m}`);
            const wrap = document.getElementById(`wrap-${m}`);
            
            const cR = cell.getBoundingClientRect();
            const wR = wrap.getBoundingClientRect();
            
            const cx = ((cR.left - wR.left + cR.width/2) / wR.width) * 100;
            const cy = ((cR.top - wR.top + cR.height/2) / wR.height) * 100;
            const rx = (30 / wR.width) * 100;
            const ry = (30 / wR.height) * 100;

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const noise = () => (Math.random()-0.5)*5;
            let p = `M ${cx+rx} ${cy} `;
            p += `Q ${cx+rx} ${cy+ry+noise()} ${cx} ${cy+ry+noise()} `;
            p += `Q ${cx-rx+noise()} ${cy+ry} ${cx-rx+noise()} ${cy} `;
            p += `Q ${cx-rx} ${cy-ry+noise()} ${cx} ${cy-ry+noise()} `;
            p += `Q ${cx+rx+noise()} ${cy-ry} ${cx+rx-5} ${cy-2} `;
            path.setAttribute("d", p);
            path.setAttribute("class", "ink-circle");
            svg.appendChild(path);
            
            setTimeout(() => cell.removeAttribute('data-circled'), 1000);
        }

        function initCalendar() {
            const container = document.getElementById('scene');
            for (let m = 12; m >= 1; m--) {
                const page = document.createElement('div');
                page.className = 'page';
                page.id = `page-${m}`;
                page.style.zIndex = 20 - m;
                page.onclick = nextMonth;

                const lunarYear = (m === 1) ? "‰πôÂ∑≥Âπ¥" : "‰∏ôÂçàÂπ¥";
                page.innerHTML = `
                    <div class="header-section">
                        <div class="month-name">${MONTHS_CN[m-1]}</div>
                        <div class="lunar-tag">${lunarYear} ¬∑ ${LUNAR[m-1]}</div>
                    </div>
                    <div class="grid-wrap" id="wrap-${m}">
                        ${genGrid(YEAR, m)}
                        <svg class="ink-layer" id="ink-${m}" viewBox="0 0 100 100" preserveAspectRatio="none"></svg>
                    </div>
                `;
                container.appendChild(page);
            }
        }

        function genGrid(y, m) {
            const d = new Date(y, m - 1, 1);
            const days = new Date(y, m, 0).getDate();
            const start = d.getDay();
            let h = '<table><thead><tr><th>Êó•</th><th>‰∏Ä</th><th>‰∫å</th><th>‰∏â</th><th>Âõõ</th><th>‰∫î</th><th>ÂÖ≠</th></tr></thead><tbody><tr>';
            for(let i=0; i<start; i++) h+='<td></td>';
            for(let i=1; i<=days; i++){
                if((start+i-1)%7===0 && i!==1) h+='</tr><tr>';
                h+=`<td id="d-${m}-${i}" onclick="event.stopPropagation(); circleDate(${m},${i})">${i}</td>`;
            }
            h+='</tr></tbody></table>';
            return h;
        }

        function playTone(type, f) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            osc.connect(g); g.connect(ctx.destination);
            const now = ctx.currentTime;
            
            if (type === 'flip') {
                osc.type = 'triangle'; osc.frequency.value = 100;
                g.gain.setValueAtTime(0.3, now);
                g.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
                osc.start(now); osc.stop(now + 0.15);
            } else if (type === 'pen') {
                osc.type = 'sine'; osc.frequency.value = f || 400;
                g.gain.setValueAtTime(0.1, now);
                g.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            }
        }

        function initUploader() {
            document.getElementById('img-uploader').onchange = (e) => {
                if(e.target.files[0]) {
                    const r = new FileReader();
                    r.onload = v => document.body.style.backgroundImage = `url('${v.target.result}')`;
                    r.readAsDataURL(e.target.files[0]);
                }
            }
        }
    </script>
</body>
</html>
